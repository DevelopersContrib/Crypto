
<!DOCTYPE html>
<html>
<head>
  <title>Token Sale</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="http://momentjs.com/downloads/moment.min.js"></script>  
  <script src="http://timeago.yarp.com/jquery.timeago.js"></script>  
  
  <style>
table {
    font-family: arial, sans-serif;
    border-collapse: collapse;
    width: 100%;
}

td, th {
    border: 1px solid #dddddd;
    text-align: left;
    padding: 8px;
}

tr:nth-child(even) {
    background-color: #dddddd;
}
</style>
</head>
<body class="container">
<h2>Token Sale: {tokensale}</h2>
<span>Funding Goal: </span><span id="fundinggoal"></span><br>
<span>Amount Raised: </span><span id="amountraised"></span><br>
<span>Deadline: </span><span id="deadline"></span> - <span id="remaining"></span><br>
<br>
<span>Send Eth: </span> <input id="ethvalue" style="width: 50px;" type="text" value="1" /> from: <input id="from" style="width:400px" type="text" value="" /> to: <input id="to" style="width:400px" type="text" value="" /> <button type="button" id="btnsendeth">Send</button><br>

<h2>Accounts</h2><span id="loading">Loading...</span>
<table id="table">
<tbody>
<tr>
<td>#</td>
<td>address</td>
<td>Token</td>
<td>Eth</td>
</tr>
</tbody>
</table>

<script type="text/javascript">
var url = window.location.origin;
$(document).ready(function() {
	$('#btnsendeth').click(function(){
		var accnt1 = $('#from').val();
		var to = $('#to').val();
		var ethvalue = $('#ethvalue').val();
		var passphrase = prompt('Enter passphrase: ');
		if(accnt1!='' && to != '' && ethvalue!= '' && !isNaN(ethvalue) && passphrase!='' ){
			$.post(url+'/send',
			{
				account:accnt1,
				passphrase:passphrase,
				value:ethvalue,
				addressto:to
			}, function(data){
				var token = jQuery.parseJSON(data);
				console.log(token.txHash);
				alert(token.txHash);
			});
		}else{
			alert('Error');
		}
	});

	$.get(url+'/getBalances?address={address}&param={param}',function(data){
		var ar = jQuery.parseJSON(data).accounts;
		var theTable = "";
		for(var j=0;j<ar.length;j++){
			theTable += '<tr>';
			for(var k=0;k<ar[j].length;k++){             
				theTable += '<td>'+ar[j][k]+'</td>';
			}
			theTable += '</tr>';
		}
		$("#table").append(theTable);
		$('#loading').remove();
	});
	
	$.get(url+'/getAmountRaised?address={tokensale}',function(data){
		var data = jQuery.parseJSON(data);
		$('#amountraised').html(data.result+' Eth');
	});
	
	$.get(url+'/getDeadline?address={tokensale}',function(data){
		var data = jQuery.parseJSON(data);

		var then = new Date(data.result*1000);
		//then.setDate(23);
		
		$('#deadline').html(then.toLocaleString());
		
		var now = new Date();

		var ms = moment(then,"DD/MM/YYYY HH:mm:ss").diff(moment(now,"DD/MM/YYYY HH:mm:ss"));
		var d = moment.duration(ms);
		var days = d.days();
		
		
		
		if(days<0){
			$('#remaining').html(jQuery.timeago(then));
		}else{
			$('#remaining').html(days+' day'+(days>1?'s and ':' and ')+d.hours()+':'+('0' + d.minutes()).slice(-2)+':'+('0' + d.seconds()).slice(-2));
		}
	});
	
	$.get(url+'/getFundingGoal?address={tokensale}',function(data){
		var data = jQuery.parseJSON(data);
		$('#fundinggoal').html(data.result+' Eth');
	});
});
</script>
</body>
	
</html>